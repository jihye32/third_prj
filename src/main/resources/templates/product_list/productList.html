<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<title>sample</title>
<link th:href="@{/css/output.css}" rel="stylesheet">
<link th:href="@{/css/test.css}" rel="stylesheet">
<style>
</style>
<!-- JQuery CDN -->
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
    // 모든 숨겨진 찜 버튼에 클릭 이벤트
    $('input.a11yHidden[type="button"]').on('click', function(event) {
    	event.preventDefault();   // ⭐ a 태그 기본 동작 차단
    	event.stopPropagation();  // ⭐ 이벤트 전파 차단

        // productNum 추출 (id에서)
        var productNum = $(this).attr('id').replace('btn_', '');

        // UI 및 서버 처리
        toggleBookmark(productNum, $(this));
    });

    function toggleBookmark(productNum, $input) {
        //console.log("찜 클릭됨:", productNum);
	
        // label 내부 svg path 선택
        var $svgPath = $input.prev('label').find('path');
        // 찜 상태 토글
        if ($svgPath.attr('fill') === '#dc2626') {
        	$.ajax({
        		url:"/bookmark/"+productNum,
        		type:"DELETE",
        		contentType:"application/JSON",
        		data:{productNum,productNum},
        		dataType:"JSON",
        		error:function(xhr){
        			alert(xhr.status)
        			},// error
        		success:function(jsonObj){
        			if(jsonObj.resultFlag){
        				// 비활성화
        	            $svgPath.attr('fill', '#9ca3afb4');
        	            $svgPath.attr('stroke', 'white');
        			}// end if
        		}// success
        	});// ajax
            
        } else {
        	$.ajax({
        		url:"/bookmark/"+productNum,
        		type:"POST",
        		contentType:"application/JSON",
        		data:{productNum,productNum},
        		dataType:"JSON",
        		error:function(xhr){
        			alert(xhr.status)
        			},// error
        		success:function(jsonObj){
        			if(jsonObj.resultFlag){
        				// 활성화
        	            $svgPath.attr('fill', '#dc2626');
        	            $svgPath.attr('stroke', '#dc2626');
        			}else{
        				alert("로그인이 필요한 서비스입니다.");
        			}// end else
        		}// success
        	});// ajax
            
        }// end else

        // 서버로 AJAX 요청 예시
        /*
        $.post('/bookmark/toggle', { productNum: productNum }, function(response){
            console.log('서버 응답:', response);
        });
        */
    }
});

function openReportForm() {
    fetch('/report/form')
        .then(res => res.text())
        .then(html => {
            // 서랍 내부의 콘텐츠 영역(ID: drawerContent)에 서버가 보낸 HTML 주입
            document.getElementById('drawerContent').innerHTML = html;
            openDrawer('제목'); // 서랍 여는 공통 함수 실행
        });
}
function searchCategory(categorycode){
	if(categorycode != null){
		var url = new URL(window.location.href);  // 현재 URL
	    url.searchParams.set('category', categorycode);
	    url.searchParams.set('currentPage', 1);
	    window.location.href = url.toString();    // 이동
	}// end if
}// searchCategory

function reset(){
	location.href="searchList";
}// reset

</script>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<script
	src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>

</script>

</head>
<body>
	<div id="__next">
		<div class="flex flex-col min-h-screen bg-white">
			<div th:replace="~{template/header :: headerImgFragment}"></div>
			<div th:replace="~{template/header :: headerFragment}"></div>

			<!-- 메인 디자인 넣는 곳 -->
			<main class="relative flex-grow border-b-2"
				style="min-height: -webkit-fill-available">
				<div
					class="mx-auto px-5 md:px-8 2xl:px-16 box-content pt-8 pb-16 bg-white lg:pt-[72px] lg:pb-20 max-w-[1024px] min-[1600px]:max-w-[1280px]">
					<div class="w-full 2xl:-ms-9">
						<div class="relative">
							<div class="flex flex-col lg:flex-row lg:items-center gap-2 items-start mb-[10px]">
							<th:block th:if="${param.keyword ne null and param.keyword ne ''}">
								<h2 class="text-2xl lg:text-[28px] font-normal w-[calc(100%-30px)] lg:w-auto text-jnBlack">
									<strong class="font-semibold">'<span th:text="${param.keyword}"></span>'</strong> 검색 결과</h2>
								<p class="text-jnGray-700" th:text="|총 ${#numbers.formatInteger({totalCnt}, 0, 'COMMA')}개|">총 n개</p>
							</th:block>
							</div>
							<h1 class="a11yHidden">전체 카테고리 | 중고나라 - 안심되는 중고거래</h1>
							<h2 class="text-[28px] font-normal mb-[10px]">검색 결과</h2>
							<button class="absolute right-1 top-2 lg:hidden">
								<svg width="20px" height="20px" viewBox="0 0 20 20" fill="none"
									xmlns="http://www.w3.org/2000/svg">
									<line x1="0.7" y1="2.85664" x2="19.3" y2="2.85664"
										stroke="#141313" stroke-width="1.4" stroke-linecap="round"></line>
									<line x1="0.7" y1="9.99922" x2="19.3" y2="9.99922"
										stroke="#141313" stroke-width="1.4" stroke-linecap="round"></line>
									<line x1="0.7" y1="17.1438" x2="19.3" y2="17.1437"
										stroke="#141313" stroke-width="1.4" stroke-linecap="round"></line>
									<circle cx="13.2552" cy="2.83333" r="1.83333" fill="white"
										stroke="#141313" stroke-width="1.4"></circle>
									<circle cx="13.2552" cy="17.2335" r="1.83333" fill="white"
										stroke="#141313" stroke-width="1.4"></circle>
									<circle cx="6.11458" cy="10.0326" r="1.83333" fill="white"
										stroke="#141313" stroke-width="1.4"></circle></svg>
							</button>
							<table class="hidden w-full lg:table filterTable">
								<tbody
									class="[&amp;&gt;tr]:border-b [&amp;&gt;tr]:border-jnGray-300">
									
									<tr>
										<td class="flex items-center justify-between"><p>카테고리</p>
											<button class="category-toggle-btn">
												<!-- 기본: + 모양 -->
											    <svg class="icon-plus" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none">
											        <path stroke="#9CA3AF" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2" d="M8 2v12M2 8h12"></path>
											    </svg>
											    <!-- 펼쳤을 때: − 모양 -->
											    <svg class="icon-minus" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" style="display:none;">
											        <path stroke="#9CA3AF" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2" d="M2 8h12"></path>
											    </svg>
											</button>
										</td>
										<td>
											<div class="flex items-center w-full chawkbazarBreadcrumb">
												<ol class="flex flex-wrap items-center w-full mt-0 lg:mt-0">
													<li class="flex-shrink-0 px-0 mt-0 text-sm break-all transition duration-200 ease-in text-body first:ps-0 last:pe-0 hover:text-heading">
														<a class="text-base font-semibold text-jnBlack font-semibold text-base text-jnBlack"
															th:href="@{/searchList(keyword=${param.keyword})}">전체</a>
													</li>
													<th:block th:if="${param.category ne null}">
													<li class="pl-0 mx-2 mt-0 text-sm leading-5 text-jnGray-500 lg:mt-0">&gt;</li>
													<li class="flex-shrink-0 px-0 mt-0 text-sm break-all transition duration-200 ease-in text-body first:ps-0 last:pe-0 hover:text-heading">
													<a th:text="${selCategoryName}" class="text-base font-semibold text-jnBlack" th:href="@{/searchList(category=${param.category}, page=1)}">패션의류</a>
													</li>
													</th:block>
												</ol>
											</div>
										</td>
									</tr>
									
									<tr class="category-toggle-tr">
										<td class="no-border"></td>
										<td class="!py-2">
											<ul class="grid grid-cols-6 text-sm">
												<li class="flex justify-start items-center !mt-0 p-2 pl-0 w" th:each="category : ${categorylist}" th:object="${category}"> 
												<!-- <a th:href="@{/searchList(category=*{categoryCode})}" th:text="*{categoryText}">카테고리</a> </li> -->
												<button th:onclick="searchCategory([[*{categoryCode}]])" >
												<div th:text="*{categoryText}">카테고리</div> </li>
												</button>
												<!-- <div th:onclick="searchCategory([[*{categoryCode}]])" th:value="*{categoryCode}" th:text="*{categoryText}">카테고리</div> </li> -->
											</ul>
										</td>
									</tr>
									
									<script>
									$(document).ready(function () {
									    // 처음엔 아래 tr 숨김
									    $('.category-toggle-tr').hide();

									    $('.category-toggle-btn').on('click', function () {
									        // + / - 아이콘 토글
									        $(this).find('.icon-plus').toggle();
									        $(this).find('.icon-minus').toggle();

									        // 아래 tr 토글
									        $('.category-toggle-tr').stop().slideToggle(200);
									    });// on
									    
									});// ready
									
									
									</script>
									
									<tr>
										<td>가격</td>
										<td class="price-filter">
											<input id="startPrice" type="number" th:value="${param.startPrice != null} ? ${param.startPrice} : ''"
											class="w-[152px] border rounded border-jnGray-200 py-[10px] px-4 text-sm font-medium"
											placeholder="최소 가격" data-idx="0" min="0" step="1">
											<span class="mx-[6px]">
												<svg
													xmlns="http://www.w3.org/2000/svg" width="10" height="4"
													fill="none" class="inline">
													<path fill="#5A616B"
															d="M7.895.628 9.297.62q0 .651-.182 1.205-.182.545-.515.947-.326.401-.788.628-.454.22-1 .22-.636 0-1.129-.25-.484-.258-1.045-.773a3.5 3.5 0 0 0-.652-.507 1.25 1.25 0 0 0-.651-.182.94.94 0 0 0-.584.182 1.14 1.14 0 0 0-.378.5 2 2 0 0 0-.137.757H.796q0-.659.183-1.197.18-.545.507-.931.333-.395.788-.606a2.3 2.3 0 0 1 1-.213q.636 0 1.144.266.516.265 1.046.757.363.349.659.523.295.174.628.174a1 1 0 0 0 .599-.19q.257-.196.401-.537a1.95 1.95 0 0 0 .144-.765">
													</path>
												</svg>
											</span>
											<input id="endPrice" th:value="${param.endPrice != null} ? ${param.endPrice} : ''"
											type="number" class="w-[152px] border rounded border-jnGray-200 py-[10px] px-4 text-sm font-medium"
											placeholder="최대 가격" data-idx="1" min="0" step="1">
										<button data-routerlink="true" id="submitBtn"
												class="w-full mt-3 lg:mt-0 lg:w-auto bg-jnBlack py-[10px] px-4 m-0 lg:mx-2 rounded text-sm font-medium text-white">적용</button></td>
									</tr>
									<script type="text/javascript">
									$('#submitBtn').click(function() {
									    var url = new URL(window.location.href);
									    var startPrice = $("#startPrice").val().trim();
									    var endPrice = $("#endPrice").val().trim();
									
									    // 공백 체크
									    if (startPrice === '' || endPrice === '') {
									        alert("가격 범위는 시작과 끝 모두 입력해야 합니다.");
									        return;
									    }
									
									    // 숫자만 입력 (정수만 허용)
									    var numberRegex = /^[0-9]+$/;
									
									    if (!numberRegex.test(startPrice) || !numberRegex.test(endPrice)) {
									        alert("가격은 숫자만 입력 가능합니다.");
									        return;
									    }
									
									    // 숫자로 변환
									    startPrice = parseInt(startPrice, 10);
									    endPrice = parseInt(endPrice, 10);
									
									    // 음수 방지 (정규식에서 이미 걸러지지만 안전하게 한번 더 체크)
									    if (startPrice < 0 || endPrice < 0) {
									        alert("가격은 음수를 입력할 수 없습니다.");
									        return;
									    }
									
									    // 시작 가격 < 끝 가격
									    if (startPrice >= endPrice) {
									        alert("시작 가격은 끝 가격보다 작아야 합니다.");
									        return;
									    }
									
									    // 조건 만족 시 URL 파라미터 설정
									    url.searchParams.set('startPrice', startPrice);
									    url.searchParams.set('endPrice', endPrice);
									    url.searchParams.set('currentPage', 1);
									
									    window.location.href = url.toString();
									});
									</script>

									<tr>
										<td>선택한 필터</td>
										<td><div
												class="flex items-center justify-between w-full h-full border-none">
												<div class="flex flex-wrap">
													<div class="flex items-center flex-shrink-0 py-2 pl-3 mb-2 mr-2 text-sm font-medium border rounded lg:m-0 lg:border-none lg:p-0 lg:text-base border-jnGray-300 text-jnBlack">
														<span class="truncate">전체</span>
														<svg width="16"
															height="16" fill="none" data-routerlink="true"
															class="flex-shrink-0 w-4 text-sm cursor-pointer ms-1 me-3 text-body fill-jnGray-600"
															size="16">
															<defs>
															<clipPath id="close-icon_svg__a">
															<path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>
													</div>
													
													<th:block th:if="${selCategoryName ne null and selCategoryName ne ''}">
														<div class="flex items-center flex-shrink-0 py-2 pl-3 mb-2 mr-2 text-sm font-medium border rounded lg:m-0 lg:border-none lg:p-0 lg:text-base border-jnGray-300 text-jnBlack">
															<span th:text="|카테고리 : ${selCategoryName}|" class="truncate"></span>
															<svg width="16"
																height="16" fill="none" data-routerlink="true"
																class="flex-shrink-0 w-4 text-sm cursor-pointer ms-1 me-3 text-body fill-jnGray-600"
																size="16">
																<defs>
																<clipPath id="close-icon_svg__a">
																<path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>
														</div>
													</th:block>
													
													<th:block th:if="${param.startPrice ne null and param.endPrice ne nul}">
														<div class="flex items-center flex-shrink-0 py-2 pl-3 mb-2 mr-2 text-sm font-medium border rounded lg:m-0 lg:border-none lg:p-0 lg:text-base border-jnGray-300 text-jnBlack">
															<span th:text="|가격 : ${param.startPrice}~${param.endPrice}|" class="truncate"></span>
															<svg width="16"
																height="16" fill="none" data-routerlink="true"
																class="flex-shrink-0 w-4 text-sm cursor-pointer ms-1 me-3 text-body fill-jnGray-600"
																size="16">
																<defs>
																<clipPath id="close-icon_svg__a">
																<path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>
														</div>
													</th:block>
													
													
													
												</div>
												<button data-routerlink="true" onclick="reset()"
													class="text-sm underline whitespace-nowrap text-jnGray-700">초기화</button>
											</div></td>
									</tr>
								</tbody>
							</table>
						</div>
						
						<ul
							class="inline-flex sticky z-10 w-full justify-end bg-white lg:top-[204px] xl:top-[220px] pt-7 pb-5 text-end">
							<li
								class="text-sm leading-[17px] [&amp;:not(:last-child)]:after:content-[''] after:inline-block after:border after:border-jnGray-300 after:h-[10px] [&amp;:last-of-type]:after:border-none font-semibold text-jnGray-900">
								<button class="px-2" onclick="sort('update')">최신순</button></li>
							<li
								class="text-sm leading-[17px] [&amp;:not(:last-child)]:after:content-[''] after:inline-block after:border after:border-jnGray-300 after:h-[10px] [&amp;:last-of-type]:after:border-none font-medium text-jnGray-600">
								<button class="px-2" onclick="sort('asc')">낮은가격순</button></li>
							<li
								class="text-sm leading-[17px] [&amp;:not(:last-child)]:after:content-[''] after:inline-block after:border after:border-jnGray-300 after:h-[10px] [&amp;:last-of-type]:after:border-none font-medium text-jnGray-600">
								<button class="px-2" onclick="sort('desc')">높은가격순</button></li>
						</ul>
						<script type="text/javascript">
	function sort(sortBy){
		var url = new URL(window.location.href);
		url.searchParams.set('sortBy', sortBy);
		url.searchParams.set('currentPage', 1);
		window.location.href = url.toString();
	}

	document.addEventListener('DOMContentLoaded', function () {
		const ul = document.querySelector('ul.inline-flex');
		const items = ul.querySelectorAll('li');

		// URL 파라미터 기준 초기 active 설정
		const params = new URLSearchParams(window.location.search);
		const currentSort = params.get('sortBy') || 'update'; // 기본값 최신순

		items.forEach(li => {
			const btn = li.querySelector('button');
			const sortValue = btn.getAttribute('onclick')
				.match(/'(.+)'/)?.[1];

			// 초기화
			li.classList.remove('font-semibold', 'text-jnGray-900');
			li.classList.add('font-medium', 'text-jnGray-600');

			// 현재 정렬과 일치하면 활성화
			if (sortValue === currentSort) {
				li.classList.remove('font-medium', 'text-jnGray-600');
				li.classList.add('font-semibold', 'text-jnGray-900');
			}
		});

		// 클릭 시 active 처리
		ul.addEventListener('click', function (e) {
			const button = e.target.closest('button');
			if (!button) return;

			const li = button.closest('li');

			items.forEach(item => {
				item.classList.remove('font-semibold', 'text-jnGray-900');
				item.classList.add('font-medium', 'text-jnGray-600');
			});

			li.classList.remove('font-medium', 'text-jnGray-600');
			li.classList.add('font-semibold', 'text-jnGray-900');
		});
	});
</script>
						<ul class="grid grid-cols-2 gap-x-3 gap-y-3 sm:grid-cols-3 xl:grid-cols-4 min-[1600px]:grid-cols-5 lg:gap-x-5 xl:gap-x-7 xl:gap-y-5 2xl:gap-y-8 search-results [&amp;_div]:ps-0">
							
							
							<th:block th:if="${tempData ne null}">
								<li th:each="temp : ${tempData}" th:object="${temp}" class="">
									<a class="relative group box-border overflow-hidden flex rounded-md cursor-pointer pe-0 pb-2 lg:pb-3 flex-col items-start transition duration-200 ease-in-out transform bg-white"
										th:href="@{/product/{productNum}(productNum=*{productNum})}">
										<div class="relative w-full rounded-md overflow-hidden dim pt-[100%] mb-3 md:mb-3.5">
										<div class="absolute inset-0 z-10 bg-opacity-[3%]"></div>
										<img th:alt-title="*{productName}" referrerpolicy="no-referrer"
											loading="lazy" decoding="async" data-nimg="fill"
											class="bg-gray-300 object-cover h-full group-hover:scale-105 w-full transition duration-200 ease-in rounded-md"
											th:src="@{/images/thumbnail/{file}(file=*{thumbnail})}"
											style="position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;">
										
										<div class="absolute bottom-2 z-20 right-2 w-6 h-6" >
											<label th:for="|btn_*{productNum}|" class="relative cursor-pointer">
												<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="pointer-events-none w-6 h-6">

													<th:block th:if="*{bookmarkFlag eq 'N'}">
														<path d="M5.94197 17.9925L15.2564 26.334C15.3282 26.3983 15.3641 26.4305 15.3975 26.4557C15.7541 26.7249 16.2459 26.7249 16.6025 26.4557C16.6359 26.4305 16.6718 26.3983 16.7436 26.3341L26.058 17.9925C28.8244 15.5151 29.1565 11.3015 26.8124 8.42125L26.5675 8.12029C23.8495 4.78056 18.5906 5.35863 16.663 9.20902C16.3896 9.75505 15.6104 9.75505 15.337 9.20902C13.4094 5.35863 8.1505 4.78056 5.43249 8.12028L5.18755 8.42125C2.84352 11.3015 3.17564 15.5151 5.94197 17.9925Z" 
															stroke-width="1.5" stroke="white" fill="#9ca3afb4">
														</path>
													</th:block>
													<th:block th:if="*{bookmarkFlag eq 'Y'}">
														<path d="M5.94197 17.9925L15.2564 26.334C15.3282 26.3983 15.3641 26.4305 15.3975 26.4557C15.7541 26.7249 16.2459 26.7249 16.6025 26.4557C16.6359 26.4305 16.6718 26.3983 16.7436 26.3341L26.058 17.9925C28.8244 15.5151 29.1565 11.3015 26.8124 8.42125L26.5675 8.12029C23.8495 4.78056 18.5906 5.35863 16.663 9.20902C16.3896 9.75505 15.6104 9.75505 15.337 9.20902C13.4094 5.35863 8.1505 4.78056 5.43249 8.12028L5.18755 8.42125C2.84352 11.3015 3.17564 15.5151 5.94197 17.9925Z" 
															stroke-width="1.5" stroke="#dc2626" fill="#dc2626">
														</path>
													</th:block>
													
												</svg>
											</label>
											<input th:id="|btn_*{productNum}|" type="button" class="a11yHidden">
										</div>
										
										<!-- <div class="absolute bottom-2 z-20 right-2 w-6 h-6" >
											<label for="|btn*{productNum}|" class="relative cursor-pointer" th:onclick="bookmark2([[${temp.productNum}]])">
												<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="pointer-events-none w-6 h-6">
												</svg>
											</label>
											<input id="|btn*{productNum}|" type="checkbox" class="a11yHidden">
										</div> -->
												

									</div>
									<div class="w-full overflow-hidden p-2 px-0">
										<h2 th:text="*{productName}" class="line-clamp-2 min-h-[2lh] text-sm md:text-base max-lg:!min-h-[20px]">상품명</h2>
										<div th:text="*{#numbers.formatInteger({price}, 3, 'COMMA') + '원'}"
											class="font-semibold space-s-2 mt-0.5 text-heading lg:text-lg lg:mt-1.5 max-lg:mt-1">가격</div>
										<div class="mt-1 mb-2 min-h-6 max-lg:mb-0 max-lg:mt-1.5">
											
											<th:block th:if="*{tradingArea ne null}">
											<span th:text="*{tradingArea}" class="text-sm text-gray-400 max-lg:text-xs">강일동</span>
											<span class="mx-1 text-sm text-gray-400">|</span>
											</th:block>
											
											<span th:text="*{timeString}" class="text-sm text-gray-400 max-lg:text-xs">방금 전</span>
										</div>
										<div
											class="flex lg:justify-between max-lg:flex-col max-lg:gap-2 max-lg:mt-3">
											<div class="flex items-center flex-wrap [&amp;&gt;*:not(:first-child)]:ml-1.5 [&amp;&gt;*]:mb-0.5 max-lg:hidden"></div>
											<div th:text="|찜 *{bookmarkCnt} ∙ 채팅 *{chatCnt}|" class="text-xs text-gray-400 text-muted">찜 0 ∙ 채팅 0</div>
										</div>
									</div></a></li>
								
								</th:block>
							</ul>
									
									
						<div class="bottom-0 py-3 m-auto text-center bg-white lg:mb-2">
							<ul class="flex justify-center space-x-2 space-x-reverse">
							<th:block th:utext="${pagination}"></th:block>
							</ul>
						</div>
						<div>
							<ul></ul>
						</div>
					</div>
				</div>
			</main>


			<div th:replace="~{template/footer :: footerFragment}"></div>
		</div>
	</div>
	<div th:replace="~{template/wrapper_frm :: drawerFrame}"></div>
</body>
</html>