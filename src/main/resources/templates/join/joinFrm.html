<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<title>회원가입</title>
<link th:href="@{/css/output.css}" rel="stylesheet">
<link th:href="@{/css/test.css}" rel="stylesheet">
<style type="text/css">
input[name="id"]::placeholder, input[name="pass"]::placeholder {
	color: #A9A9A9;
}

input[type="date"]::-webkit-calendar-picker-indicator {
	cursor: pointer;
}
</style>
<!-- JQuery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript">
$(function() {
	var joinFlag = "[[${joinFlag}]]";
	
	if (joinFlag === "fail") {
        alert("회원가입에 실패하였습니다. 다시 시도해주세요.");
    }// end if
	
    // 중복확인 및 인증 여부를 체크하기 위한 플래그
    let isIdChecked = false;
    let isStoreNameChecked = false;
    let isEmailVerified = false;
    
    // 정규표현식 정의
    const idReg = /^[a-zA-Z0-9]{6,12}$/;
    const passReg = /^[a-zA-Z0-9!@#$%^&*()_+|<>?:{}]{8,15}$/;

    // 1. 아이디 중복 확인
    $("#idChkBtn").click(function() {
        const id = $("input[name='id']").val().trim();
        if(id === "") {
            alert("아이디를 입력해주세요.");
            return;
        }
        
        // 아이디 유효성 검사 (6~12자, 영문/숫자)
        if(!idReg.test(id)) {
            alert("아이디는 영문 대소문자와 숫자를 사용하여 6~12자리로 입력해주세요.");
            $("input[name='id']").focus();
            return;
        }

        $.ajax({
            url: "/join/idDup",
            type: "GET",
            data: { id: id },
            success: function(isAvailable) {
                if(isAvailable) {
                    $("#idChkMsg").text("사용 가능한 아이디입니다.").css("color", "#0DCC5A");
                    isIdChecked = true;
                    
                    $("input[name='id']").attr("readonly", true).css("background-color", "#F5F5F5");
                    $("#idChkBtn").attr("disabled", true).css("opacity", "0.5").css("cursor", "default");
                } else {
                    $("#idChkMsg").text("이미 사용 중인 아이디입니다.").css("color", "red");
                    isIdChecked = false;
                }
            },
            error: function() {
                alert("아이디 중복 확인 중 오류가 발생했습니다.");
            }
        });
    });

    // 2. 가게명 중복 확인
    $("#storeNameChkBtn").click(function() {
        const storeName = $("input[name='storeName']").val().trim();
        if(storeName === "") {
            alert("가게명을 입력해주세요.");
            return;
        }

        $.ajax({
            url: "/join/storeNameDup",
            type: "GET",
            data: { storeName: storeName },
            success: function(isAvailable) {
                if(isAvailable) {
                    $("#storeNameChkMsg").text("사용 가능한 가게명입니다.").css("color", "#0DCC5A");
                    isStoreNameChecked = true;
                    
                    $("input[name='storeName']").attr("readonly", true).css("background-color", "#F5F5F5");
                    $("#storeNameChkBtn").attr("disabled", true).css("opacity", "0.5").css("cursor", "default");
                } else {
                    $("#storeNameChkMsg").text("이미 사용 중인 가게명입니다.").css("color", "red");
                    isStoreNameChecked = false;
                }
            },
            error: function() {
                alert("가게명 중복 확인 중 오류가 발생했습니다.");
            }
        });
    });

    // 3. 인증번호 전송
    $("#sendVerifyCodeBtn").click(function() {
        const emailLocal = $("input[name='emailLocal']").val().trim();
        const emailDomain = $("select[name='emailDomain']").val();

        if(emailLocal === "") {
            alert("이메일을 입력해주세요.");
            return;
        }

        $("#sendVerifyCodeMsg").text("인증번호를 발송 중입니다...").css("color", "black");

        $.ajax({
            url: "/join/sendVerifyCode",
            type: "GET",
            data: { emailLocal: emailLocal, emailDomain: emailDomain },
            success: function(result) {
                if(result) {
                    $("#sendVerifyCodeMsg").text("인증번호가 발송되었습니다.").css("color", "#0DCC5A");
                } else {
                    $("#sendVerifyCodeMsg").text("발송 실패. 이메일을 다시 확인해주세요.").css("color", "red");
                }
            },
            error: function() {
                alert("서버 통신 오류가 발생했습니다.");
            }
        });
    });

    // 4. 인증번호 확인
    $("#verifyCodeChkBtn").click(function() {
        const inputCode = $("input[name='inputCode']").val().trim();
        if(inputCode === "") {
            alert("인증번호를 입력해주세요.");
            return;
        }

        $.ajax({
            url: "/join/verifyCodeChk",
            type: "POST",
            data: { inputCode: inputCode },
            success: function(isMatch) {
                if(isMatch) {
                    $("#verifyCodeChkMsg").text("인증에 성공했습니다.").css("color", "#0DCC5A");
                    isEmailVerified = true;
                    
                    $("input[name='emailLocal']").attr("readonly", true).css("background-color", "#F5F5F5");
                    $("select[name='emailDomain']").attr("disabled", true).css("background-color", "#F5F5F5");
                    $("input[name='inputCode']").attr("readonly", true).css("background-color", "#F5F5F5");
                    
                    $("#sendVerifyCodeBtn, #verifyCodeChkBtn").attr("disabled", true).css("opacity", "0.5").css("cursor", "default");
                } else {
                    $("#verifyCodeChkMsg").text("인증번호가 일치하지 않습니다.").css("color", "red");
                    isEmailVerified = false;
                }
            },
            error: function() {
                alert("인증 확인 중 오류가 발생했습니다.");
            }
        });
    });

    // 5. 최종 회원가입 버튼 클릭
    $("#joinBtn").click(function() {
        // 아이디 검증
        const id = $("input[name='id']").val().trim();
        if(id === "") {
            alert("아이디를 입력해주세요.");
            $("input[name='id']").focus();
            return;
        }
        if(!isIdChecked) {
            alert("아이디 중복 확인을 해주세요.");
            $("#idChkBtn").focus();
            return;
        }

        // 비밀번호 검증
        const pass = $("input[name='pass']").val();
        const passChk = $("input[name='passChk']").val();
        if(pass === "") {
            alert("비밀번호를 입력해주세요.");
            $("input[name='pass']").focus();
            return;
        }
        if(passChk === "") {
            alert("비밀번호 확인을 입력해주세요.");
            $("input[name='passChk']").focus();
            return;
        }
        if(pass !== passChk) {
            alert("비밀번호가 일치하지 않습니다.");
            $("input[name='passChk']").focus();
            return;
        }
        
     	// 비밀번호 유효성 검사 (8~15자, 영문/숫자/특수문자)
        if(!passReg.test(pass)) {
            alert("비밀번호는 영문 대소문자와 숫자, 특수문자를 사용하여 8~15자리로 입력해주세요.");
            $("input[name='pass']").focus();
            return;
        }

        // 이름 검증
        const userName = $("input[name='userName']").val().trim();
        if(userName === "") {
            alert("이름을 입력해주세요.");
            $("input[name='userName']").focus();
            return;
        }

        // 가게명 검증
        const storeName = $("input[name='storeName']").val().trim();
        if(storeName === "") {
            alert("가게명을 입력해주세요.");
            $("input[name='storeName']").focus();
            return;
        }
        if(!isStoreNameChecked) {
            alert("가게명 중복 확인을 해주세요.");
            $("#storeNameChkBtn").focus();
            return;
        }

        // 생년월일 검증
        const birth = $("input[name='birth']").val();
        if(birth === "") {
            alert("생년월일을 선택해주세요.");
            $("input[name='birth']").focus();
            return;
        }

        // 이메일 검증
        const emailLocal = $("input[name='emailLocal']").val().trim();
        if(emailLocal === "") {
            alert("이메일 주소를 입력해주세요.");
            $("input[name='emailLocal']").focus();
            return;
        }
        
        // 인증번호 검증
        const inputCode = $("input[name='inputCode']").val().trim();
        if(inputCode === "") {
            alert("인증번호를 입력해주세요.");
            $("input[name='inputCode']").focus();
            return;
        }
        if(!isEmailVerified) {
            alert("이메일 인증을 완료해주세요.");
            return;
        }

        // 모든 검증 통과 시 제출
        if(confirm("회원가입을 진행하시겠습니까?")) {
        	$("select[name='emailDomain']").attr("disabled", false);
            $("#joinFrm").submit();
        }
    });
});// ready
</script>
</head>
<body>
	<div id="__next" style="height: auto !important;">
		<div
			class="md:px-8 2xl:px-16 flex flex-col gap-8 justify-center items-center px-0 mx-auto min-h-[100vh] sm:w-full sm:my-auto w-full max-w-full box-border [&amp;&gt;*]:z-[1]">
			<!-- 상단 로고 -->
			<a class="inline-flex focus:outline-none relative" href="/"
				style="width: 200px; height: 30px; margin-top: 100px;"> <img
				alt="logo" loading="eager" decoding="async" data-nimg="fill"
				src="/images/main_logo.png"
				style="position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;">
			</a>
			<div>
				<div type="default" style="margin-bottom: 100px; text-align: center">
					<div
						class="relative mx-auto w-screen bg-white sm:w-[450px] sm:border sm:border-gray-300 sm:overflow-hidden sm:rounded-lg px-5 sm:px-8">
						<div>
							<div class="flex flex-col justify-between min-h-[500px]">
								<h2 class="headline-semibold-20 sm:headline-semibold-24"
									style="text-align: center; margin-top: 32px">회원가입</h2>
								<form th:action="@{/join/joinProcess}" method="post"
									id="joinFrm">
									<!-- 아이디 -->
									<div class="mt-atuo">
										<div class="mt-6">
											<label for="user-id" class="flex justify-start items-center">
												<span class="inline-block text-sm font-semibold">아이디</span>
											</label>
										</div>
										<input type="text" name="id" data-variant="flat" placeholder="영문/숫자 6~12자"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center transition ease-in-out duration-300 font-semibold font-body border rounded-md px-5 py-4 h-11 md:h-12 w-full mt-2.5 focus:ring-2 focus:ring-black focus:outline-none"
											style="background-color: white; border: 1px solid black;">
										<button type="button" id="idChkBtn" data-variant="flat"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center cursor-pointer transition ease-in-out duration-300 font-semibold font-body text-center border-0 border-transparent placeholder-white focus-visible:outline-none focus:outline-none rounded-md px-5 md:px-6 lg:px-8 py-4 md:py-3.5 lg:py-4 hover:shadow-cart h-11 md:h-12 w-full mt-2.5 bg-kakao hover:bg-kakao hover:text-black text-black justify-between"
											style="background-color: black;">
											<span class="flex-1 mr-[22px]"
												style="color: white; text-align: left; margin-left: 10px;">아이디
												중복확인</span>
										</button>
										<!-- 아이디 중복확인 메시지 -->
										<div id="idChkMsg" style="font-size: 0.8em; margin-top: 5px;"></div>
									</div>
									<!-- 비밀번호 -->
									<div class="mt-atuo">
										<div class="mt-6">
											<label for="user-pass"
												class="flex justify-start items-center"> <span
												class="inline-block text-sm font-semibold">비밀번호</span>
											</label>
										</div>
										<input type="password" name="pass" data-variant="flat" placeholder="영문/숫자/특수문자 8~15자"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center transition ease-in-out duration-300 font-semibold font-body border rounded-md px-5 py-4 h-11 md:h-12 w-full mt-2.5 focus:ring-2 focus:ring-black focus:outline-none"
											style="background-color: white; border: 1px solid black;">
									</div>
									<!-- 비밀번호 확인 -->
									<div class="mt-atuo">
										<div class="mt-6">
											<label for="user-pass-check"
												class="flex justify-start items-center"> <span
												class="inline-block text-sm font-semibold">비밀번호 확인</span>
											</label>
										</div>
										<input type="password" name="passChk" data-variant="flat"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center transition ease-in-out duration-300 font-semibold font-body border rounded-md px-5 py-4 h-11 md:h-12 w-full mt-2.5 focus:ring-2 focus:ring-black focus:outline-none"
											style="background-color: white; border: 1px solid black;">
									</div>
									<!-- 이름 -->
									<div class="mt-atuo">
										<div class="mt-6">
											<label for="user-name"
												class="flex justify-start items-center"> <span
												class="inline-block text-sm font-semibold">이름</span>
											</label>
										</div>
										<input type="text" name="userName" data-variant="flat"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center transition ease-in-out duration-300 font-semibold font-body border rounded-md px-5 py-4 h-11 md:h-12 w-full mt-2.5 focus:ring-2 focus:ring-black focus:outline-none"
											style="background-color: white; border: 1px solid black;">
									</div>
									<!-- 가게명 -->
									<div class="mt-atuo">
										<div class="mt-6">
											<label for="store-name"
												class="flex justify-start items-center"> <span
												class="inline-block text-sm font-semibold">가게명</span>
											</label>
										</div>
										<input type="text" name="storeName" data-variant="flat"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center transition ease-in-out duration-300 font-semibold font-body border rounded-md px-5 py-4 h-11 md:h-12 w-full mt-2.5 focus:ring-2 focus:ring-black focus:outline-none"
											style="background-color: white; border: 1px solid black;">
										<button type="button" id="storeNameChkBtn" data-variant="flat"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center cursor-pointer transition ease-in-out duration-300 font-semibold font-body text-center border-0 border-transparent placeholder-white focus-visible:outline-none focus:outline-none rounded-md px-5 md:px-6 lg:px-8 py-4 md:py-3.5 lg:py-4 hover:shadow-cart h-11 md:h-12 w-full mt-2.5 bg-kakao hover:bg-kakao hover:text-black text-black justify-between"
											style="background-color: black;">
											<span class="flex-1 mr-[22px]"
												style="color: white; text-align: left; margin-left: 10px;">가게명
												중복확인</span>
										</button>
										<!-- 가게명 중복확인 메시지 -->
										<div id="storeNameChkMsg"
											style="font-size: 0.8em; margin-top: 5px;"></div>
									</div>
									<!-- 생년월일 -->
									<div class="mt-atuo">
										<div class="mt-6">
											<label for="user-birth"
												class="flex justify-start items-center"> <span
												class="inline-block text-sm font-semibold">생년월일</span>
											</label>
										</div>
										<input type="date" name="birth"
											class="text-[13px] md:text-sm leading-4 items-center transition ease-in-out duration-300 font-semibold font-body border rounded-md px-5 py-4 h-11 md:h-12 w-full mt-2.5 focus:ring-2 focus:ring-black focus:outline-none"
											style="background-color: white; border: 1px solid black;">
									</div>
									<!-- 이메일 -->
									<div class="mt-atuo">
										<div class="mt-6">
											<label for="user-email"
												class="flex justify-start items-center"> <span
												class="inline-block text-sm font-semibold">이메일</span>
											</label>
										</div>
										<input type="text" name="emailLocal" data-variant="flat"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center transition ease-in-out duration-300 font-semibold font-body border rounded-md px-5 py-4 h-11 md:h-12 w-full mt-2.5 focus:ring-2 focus:ring-black focus:outline-none"
											style="background-color: white; border: 1px solid black;">
										<select name="emailDomain" data-variant="flat"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center transition ease-in-out duration-300 font-semibold font-body border rounded-md px-5 py-4 h-11 md:h-12 w-full mt-2.5 focus:ring-2 focus:ring-black focus:outline-none"
											style="background-color: white; border: 1px solid black; padding: 10px; cursor: pointer">
											<option value="@naver.com">@naver.com</option>
											<option value="@gmail.com">@gmail.com</option>
											<option value="@daum.net">@daum.net</option>
										</select>
										<button type="button" id="sendVerifyCodeBtn"
											data-variant="flat"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center cursor-pointer transition ease-in-out duration-300 font-semibold font-body text-center border-0 border-transparent placeholder-white focus-visible:outline-none focus:outline-none rounded-md px-5 md:px-6 lg:px-8 py-4 md:py-3.5 lg:py-4 hover:shadow-cart h-11 md:h-12 w-full mt-2.5 bg-kakao hover:bg-kakao hover:text-black text-black justify-between"
											style="background-color: black;">
											<span class="flex-1 mr-[22px]"
												style="color: white; text-align: left; margin-left: 10px;">인증번호
												전송</span>
										</button>
										<!-- 이메일 인증번호 전송 확인 메시지 -->
										<div id="sendVerifyCodeMsg"
											style="font-size: 0.8em; margin-top: 5px;"></div>
									</div>
									<!-- 이메일 인증번호 -->
									<div class="mt-atuo">
										<div class="mt-6">
											<label for="verify-code"
												class="flex justify-start items-center"> <span
												class="inline-block text-sm font-semibold">인증번호</span>
											</label>
										</div>
										<input type="text" name="inputCode" data-variant="flat"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center transition ease-in-out duration-300 font-semibold font-body border rounded-md px-5 py-4 h-11 md:h-12 w-full mt-2.5 focus:ring-2 focus:ring-black focus:outline-none"
											style="background-color: white; border: 1px solid black;">
										<button type="button" id="verifyCodeChkBtn"
											data-variant="flat"
											class="text-[13px] md:text-sm leading-4 inline-flex items-center cursor-pointer transition ease-in-out duration-300 font-semibold font-body text-center border-0 border-transparent placeholder-white focus-visible:outline-none focus:outline-none rounded-md px-5 md:px-6 lg:px-8 py-4 md:py-3.5 lg:py-4 hover:shadow-cart h-11 md:h-12 w-full mt-2.5 bg-kakao hover:bg-kakao hover:text-black text-black justify-between"
											style="background-color: black;">
											<span class="flex-1 mr-[22px]"
												style="color: white; text-align: left; margin-left: 10px;">인증하기</span>
										</button>
										<!-- 이메일 인증번호 인증 확인 메시지 -->
										<div id="verifyCodeChkMsg"
											style="font-size: 0.8em; margin-top: 5px;"></div>
									</div>
								</form>
							</div>
						</div>
						<div
							class="w-full font-semibold text-center text-black text-sm my-5 hidden sm:block"></div>
					</div>
					<input type="button" id="joinBtn" value="회원가입" data-variant="flat"
						class="text-[13px] md:text-sm leading-4 inline-flex items-center cursor-pointer transition ease-in-out duration-300 font-semibold font-body text-center border-0 border-transparent placeholder-white focus-visible:outline-none focus:outline-none rounded-md px-5 md:px-6 lg:px-8 py-4 md:py-3.5 lg:py-4 hover:shadow-cart h-11 md:h-12 w-full mt-2.5 bg-kakao hover:bg-kakao hover:text-black text-black justify-between"
						style="background-color: black; width: 383px; margin-top: 30px; color: white;">
				</div>
			</div>
		</div>
	</div>
</body>
</html>
