<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="UTF-8">
<title>쌍용장터 관리자센터 - 회원관리</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet" type="text/css"
	th:href="@{/css/manager_member.css}">
<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
	<header th:replace="manage/common_layout :: header"></header>
	<div class="wrapper">
		<aside th:replace="manage/common_layout :: sidebar"></aside>
		<main id="main-container">
			<div class="container-fluid">
				<h3 class="mb-4 fw-bold">회원관리</h3>
				<div class="table_card">
					<table
						class="table table-hover align-middle text-center custom-admin-table">
						<thead class="table-light">
							<tr>
								<th style="width: 50px;">번호</th>
								<th style="width: 120px;">아이디</th>
								<th style="width: 150px;">상태</th>
								<th>상점명</th>
								<th style="width: 120px;">계정 생성일</th>
								<th style="width: 100px;">계정 삭제</th>
								<th style="width: 110px;">상세페이지</th>
								<th style="width: 110px;">거래내역</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="m, mStat : ${memberList}"
								th:onclick="|location.href='@{/manage/member/member_detail(userId=${m.user_id})}'|"
								style="cursor: pointer"
								th:classappend="${m.suspension_flag == 'Y'} ? 'table-danger-light' : ''">

								<td th:text="${mStat.count}"></td>
								<td th:text="${m.user_id}" class="fw-bold"></td>

								<td>
									<div class="status-flex-box"
										th:if="${m.suspension_flag == 'Y'}">
										<span class="badge-stop">정지</span> 
									</div> <span th:if="${m.suspension_flag == 'N'}" class="badge-normal">정상</span>
								</td>

								<td class="text-truncate" style="max-width: 150px;"
									th:text="${m.store_name ?: '상점없음'}"></td>
								<td th:text="${#dates.format(m.input_date, 'yyyy-MM-dd')}"></td>

								<td onclick="event.stopPropagation();">
									<button class="btn-table-del"
										th:onclick="deleteMember([[${m.user_id}]])">삭제</button>
								</td>
								<td onclick="event.stopPropagation();">
									<button class="btn-table-navy"
										th:onclick="|location.href='@{/manage/member/member_prdv(userId=${m.user_id})}'|">상점 상세정보</button>
								</td>
								<td onclick="event.stopPropagation();">
									<button class="btn-table-navy"
										th:onclick="|location.href='@{/manage/member/member_product(userId=${m.user_id})}'|">구매/판매내역</button>
								</td>
							</tr>
						</tbody>
					</table>
					<div class="mt-4 d-flex justify-content-center">
						<div th:if="${pagination != null}" th:utext="${pagination}"></div>
					</div>
				</div>
			</div>
		</main>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

	<script>
    function deleteMember(userId) {
        if (!confirm(userId + " 회원을 삭제하시겠습니까?")) return;

        fetch('/manage/member/delete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'userId=' + encodeURIComponent(userId)
        })
        .then(response => {
            if (response.ok) {
                alert("삭제 처리가 완료되었습니다.");
                location.reload();
            } else {
                alert("삭제 처리 중 오류가 발생했습니다.");
            }
        })
        .catch(error => alert("통신 오류 발생: " + error));
    }
    </script>
</body>
</html>