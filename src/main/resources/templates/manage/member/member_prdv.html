<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="UTF-8">
<title>쌍용장터 관리자센터 - 상점상세</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" type="text/css"
	th:href="@{/css/manager_prdv.css}">
<link rel="stylesheet" th:href="@{/css/style.css}">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>
	<header th:replace="manage/common_layout :: header"></header>

	<div class="wrapper">
		<aside th:replace="manage/common_layout :: sidebar"></aside>

		<main id="main-container">
			<div class="container-fluid">
				<div class="shop-header align-items-center d-flex"
					th:if="${store != null}">
					<div class="col-auto me-4">
						<img
							th:src="${store.profile_img != null and store.profile_img != ''} 
                                     ? @{/images/profile/{img}(img=${store.profile_img})} 
                                     : @{/images/profile/default.jpg}"
							alt="상점 프로필" class="shop-profile-img"
							th:onerror="this.src=[[@{/images/profile/default.jpg}]]">
					</div>
					<div class="col">
						<h4 class="fw-bold mb-1"
							th:text="${store.store_name ?: '이름 없는 상점'}">상점명</h4>
						<p class="shop-info-text mb-2"
							th:text="${store.introduce ?: '등록된 소개글이 없습니다.'}">소개글</p>
						<div class="shop-badges">
							<span class="me-3"><i class="bi bi-shield-check"></i>본인인증
								완료</span> <span><i class="bi bi-shop"></i>상점오픈일 <span
								th:text="${store.open_days ?: 0}">0</span>일 전</span>
						</div>
					</div>
				</div>

				<div class="row shop-header align-items-center"
					th:unless="${store != null}">
					<div class="col text-center py-4 bg-light rounded">
						<p class="text-muted mb-0">
							<i class="bi bi-exclamation-circle me-2"></i>개설된 상점 정보가 없는 회원입니다.
						</p>
					</div>
				</div>

				<div
					class="d-flex justify-content-between align-items-center mt-4 border-bottom-black">
					<ul class="nav nav-tabs border-0" id="shopTabs" role="tablist">
						<li class="nav-item">
							<button class="nav-link active" id="product-tab"
								data-bs-toggle="tab" data-bs-target="#product-pane"
								type="button" role="tab" aria-selected="true">
								상품 <span class="text-danger" th:text="${totalCount ?: 0}">0</span>
							</button>
						</li>
						<li class="nav-item">
							<button class="nav-link" id="review-tab" data-bs-toggle="tab"
								data-bs-target="#review-pane" type="button" role="tab"
								aria-selected="false">
								상점 후기 <span class="text-danger"
									th:text="${reviewList != null ? #lists.size(reviewList) : 0}">0</span>
							</button>
						</li>
					</ul>

					<div class="btn-group-wrap pb-2">
						<a th:href="@{/manage/member/member_detail(userId=${userId})}"
							class="btn btn-sm btn-primary px-3 me-2 fw-bold">회원 상세정보</a> <a
							th:href="@{/manage/member/member_product(userId=${userId})}"
							class="btn btn-sm btn-primary px-3 fw-bold">구매·판매내역</a>
					</div>
				</div>

				<div class="tab-content mt-4">
					<div class="tab-pane fade show active" id="product-pane"
						role="tabpanel" aria-labelledby="product-tab">
						<div
							class="d-flex justify-content-between align-items-center mb-3">
							<div>
								전체 <span class="text-danger fw-bold"
									th:text="${totalCount ?: 0}">0</span>개
							</div>
							<div class="small text-muted sort-links">
								<a th:href="@{?(userId=${userId}, sort='latest')}"
									th:classappend="${sort == 'latest' ? 'fw-bold text-dark' : ''}">최신순</a>
								| <a th:href="@{?(userId=${userId}, sort='popular')}"
									th:classappend="${sort == 'popular' ? 'fw-bold text-dark' : ''}">인기순</a>
								| <a th:href="@{?(userId=${userId}, sort='lowPrice')}"
									th:classappend="${sort == 'lowPrice' ? 'fw-bold text-dark' : ''}">저가순</a>
								| <a th:href="@{?(userId=${userId}, sort='highPrice')}"
									th:classappend="${sort == 'highPrice' ? 'fw-bold text-dark' : ''}">고가순</a>
							</div>
						</div>
						<table class="table table-custom text-center">
							<thead>
								<tr>
									<th>상품번호</th>
									<th class="text-start">상품 이름</th>
									<th>지역 정보</th>
									<th>판매 가격</th>
									<th>판매 상태</th>
									<th>상품등록일자</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="p : ${productList}">
									<td th:text="${p.product_num}">번호</td>
									<td class="text-start fw-bold" th:text="${p.title}">상품명</td>
									<td th:text="${p.addr ?: '지역 정보 없음'}">지역</td>
									<td class="text-dark fw-bold"
										th:text="${p.price != null ? #numbers.formatInteger(p.price, 3, 'COMMA') + '원' : '0원'}">0원</td>
									<td><span class="status-badge"
										th:classappend="${p.status_code == 1 ? 'status-selling' : 'status-reserved'}"
										th:text="${p.status_code == 1 ? '판매중' : '예약중'}">상태</span></td>
									<td th:text="${p.p_input_date}">날짜</td>
								</tr>
								<tr th:if="${#lists.isEmpty(productList)}">
									<td colspan="6" class="py-5 text-muted">등록된 상품이 없습니다.</td>
								</tr>
							</tbody>
						</table>
						<div class="d-flex justify-content-center mt-5">
							<div th:if="${pagination != null}" th:utext="${pagination}"></div>
						</div>
					</div>

					<div class="tab-pane fade" id="review-pane" role="tabpanel"
						aria-labelledby="review-tab">
						<div class="review-container"
							th:if="${not #lists.isEmpty(reviewList)}">
							<div class="review-item" th:each="r : ${reviewList}">
								<div class="d-flex justify-content-between align-items-start">
									<div class="d-flex">
										<img th:src="@{/images/profile/default.jpg}"
											class="review-writer-img me-3">
										<div>
											<div class="fw-bold" th:text="${r.writer_id ?: '익명'}">작성자</div>
											<div class="star-rating">
												<i class="bi bi-star-fill"
													th:each="num : ${#numbers.sequence(1, r.review_rate ?: 1)}"></i>
											</div>
										</div>
									</div>
									<div class="text-end">
										<div class="review-date" th:text="${r.review_date}">날짜</div>
									</div>
								</div>

								<div class="mt-2">
									<span
										class="badge bg-light text-dark border-secondary-subtle fw-normal">
										<i class="bi bi-tag-fill me-1"></i> <span th:text="${r.title}">상품명</span>
									</span>
								</div>

								<div
									class="review-content text-muted border p-3 rounded bg-light mt-2"
									th:text="${r.review_text}">리뷰 내용</div>
							</div>
						</div>
						<div th:if="${#lists.isEmpty(reviewList)}"
							class="text-center py-5 text-muted">작성된 상점 후기가 없습니다.</div>
					</div>
				</div>
			</div>
		</main>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>