<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="UTF-8">
<title>쌍용장터 관리자센터 - 회원관리</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" type="text/css" th:href="@{/css/manager_prdv.css}">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>

	<header id="kakaoHead">
		<div class="tit_logo">쌍용장터 관리자센터</div>
		<div class="util_menu">
			<a th:href="@{/logout}" class="btn_logout">로그아웃</a>
		</div>
	</header>

	<div class="wrapper">
		<aside class="menu_side">
			<div class="menu_group">관리자 메뉴</div>
			<ul class="list_menu">
				<li>대시보드</li>
				<li><a th:href="@{/manage/product/product_main}" style="text-decoration: none; color: inherit; display: block; width: 100%;">물품관리</a></li>
				<li class="active">회원관리</li>
				<li>고객센터관리</li>
				<li>신고관리</li>
				<li>매출관리</li>
				<li>이벤트관리</li>
			</ul>
		</aside>

		<div class="container py-5">
			<div class="row shop-header align-items-center" th:if="${store != null}">
				<div class="col-auto">
					<img th:src="${store.profile_img != null and store.profile_img != 'default.jpg' ? '/upload/' + store.profile_img : 'https://via.placeholder.com/80'}"
						alt="상점 프로필" class="shop-profile-img">
				</div>
				<div class="col">
					<h4 class="fw-bold mb-1" th:text="${store.store_name ?: '이름 없는 상점'}">상점명</h4>
					<p class="shop-info-text mb-2" th:text="${store.introduce ?: '등록된 소개글이 없습니다.'}">소개글</p>
					<div class="shop-badges">
						<span class="me-3"><i class="bi bi-shield-check"></i>본인인증 완료</span> 
						<span><i class="bi bi-shop"></i>상점오픈일 <span th:text="${store.open_days ?: 0}">0</span>일 전</span>
					</div>
				</div>
			</div>

			<div class="row shop-header align-items-center" th:unless="${store != null}">
				<div class="col text-center py-4 bg-light rounded">
					<p class="text-muted mb-0"><i class="bi bi-exclamation-circle me-2"></i>개설된 상점 정보가 없는 회원입니다.</p>
				</div>
			</div>

			<ul class="nav nav-tabs" id="shopTabs" role="tablist">
				<li class="nav-item" role="presentation">
					<button class="nav-link active" id="product-tab" data-bs-toggle="tab" data-bs-target="#product-pane" type="button" role="tab" aria-selected="true">
						상품 <span class="text-danger" th:text="${totalCount ?: 0}">0</span>
					</button>
				</li>
				<li class="nav-item" role="presentation">
					<button class="nav-link" id="review-tab" data-bs-toggle="tab" data-bs-target="#review-pane" type="button" role="tab" aria-selected="false">
						상점 후기 <span class="text-danger" th:text="${reviewList != null ? #lists.size(reviewList) : 0}">0</span>
					</button>
				</li>
			</ul>

			<div class="tab-content">
				<div class="tab-pane fade show active" id="product-pane" role="tabpanel" aria-labelledby="product-tab">
					<div class="d-flex justify-content-between align-items-center mb-3">
						<div>전체 <span class="text-danger fw-bold" th:text="${totalCount ?: 0}">0</span>개</div>
						<div class="small text-muted sort-links">
							<a th:href="@{?(userId=${userId}, sort='latest')}" th:classappend="${sort == 'latest' ? 'fw-bold text-dark' : ''}" style="text-decoration: none; color: inherit;">최신순</a> | 
							<a th:href="@{?(userId=${userId}, sort='popular')}" th:classappend="${sort == 'popular' ? 'fw-bold text-dark' : ''}" style="text-decoration: none; color: inherit;">인기순</a> | 
							<a th:href="@{?(userId=${userId}, sort='lowPrice')}" th:classappend="${sort == 'lowPrice' ? 'fw-bold text-dark' : ''}" style="text-decoration: none; color: inherit;">저가순</a> | 
							<a th:href="@{?(userId=${userId}, sort='highPrice')}" th:classappend="${sort == 'highPrice' ? 'fw-bold text-dark' : ''}" style="text-decoration: none; color: inherit;">고가순</a>
						</div>
					</div>

					<table class="table table-custom text-center">
						<thead>
							<tr>
								<th>상품번호</th>
								<th class="text-start">상품 이름</th>
								<th>지역 정보</th>
								<th>판매 가격</th>
								<th>판매 상태</th>
								<th>상품등록일자</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="p : ${productList}">
								<td th:text="${p.product_num}">번호</td>
								<td class="text-start" th:text="${p.title}">상품명</td>
								<td th:text="${p.addr ?: '지역 정보 없음'}">지역</td>
								<td th:text="${p.price != null ? #numbers.formatInteger(p.price, 3, 'COMMA') + '원' : '0원'}">0원</td>
								<td><span class="status-badge" th:text="${p.status_code == 1 ? '판매중' : (p.status_code == 2 ? '예약중' : '판매완료')}">상태</span></td>
								<td th:text="${p.p_input_date ?: '-'}">날짜</td>
							</tr>
							<tr th:if="${productList == null or #lists.isEmpty(productList)}">
								<td colspan="6" class="py-5 text-muted">등록된 상품이 없습니다.</td>
							</tr>
						</tbody>
					</table>

					<div class="d-flex justify-content-center mt-5">
						<div th:if="${pagination != null}" th:utext="${pagination}"></div>
					</div>
				</div>

				<div class="tab-pane fade" id="review-pane" role="tabpanel" aria-labelledby="review-tab">
					<div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
						<h5 class="fw-bold">상점후기 <span class="text-danger" th:text="${reviewList != null ? #lists.size(reviewList) : 0}">0</span></h5>
					</div>

					<div class="review-container" th:if="${reviewList != null and !#lists.isEmpty(reviewList)}">
						<div class="review-item" th:each="r, rStat : ${reviewList}" th:style="${rStat.index >= 2 ? 'display:none' : ''}">
							<div class="d-flex justify-content-between">
								<div class="d-flex">
									<img src="https://via.placeholder.com/50" alt="작성자 프로필" class="review-writer-img me-3">
									<div>
										<div class="fw-bold" th:text="${r.writer_id ?: '익명'}">작성자</div>
										<div class="star-rating">
											<i class="bi bi-star-fill" th:if="${r.review_rate > 0}" th:each="num : ${#numbers.sequence(1, r.review_rate)}"></i>
											<span th:if="${r.review_rate == 0}" class="text-muted small">별점 없음</span>
										</div>
									</div>
								</div>
								<div class="text-end">
									<button class="btn btn-sm btn-outline-secondary btn-hide mb-2">숨기기</button>
									<div class="review-date" th:text="${r.review_date ?: '-'}">날짜</div>
								</div>
							</div>
							<div class="review-content text-muted border p-3 rounded bg-light mt-3" th:text="${r.review_text ?: '내용 없음'}">후기 내용</div>
						</div>
					</div>

					<div th:if="${reviewList == null or #lists.isEmpty(reviewList)}" class="text-center py-5 text-muted">
						작성된 상점 후기가 없습니다.
					</div>

					<div class="text-center mt-4" th:if="${reviewList != null and #lists.size(reviewList) > 2}">
						<button class="btn btn-outline-secondary rounded-pill px-4" id="btn-review-more">
							<i class="bi bi-plus-circle me-2"></i>상점후기 더보기
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script type="text/javascript">
		$(function() {
			$('#btn-review-more').on('click', function() {
				$('.review-item').fadeIn();
				$(this).parent().hide();
			});
		});
	</script>
</body>
</html>