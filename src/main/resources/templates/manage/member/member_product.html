<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="UTF-8">
<title>쌍용장터 관리자센터 - 거래내역</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" type="text/css" th:href="@{/css/manager_member_product.css}">
<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
	<header th:replace="manage/common_layout :: header"></header>

	<div class="wrapper">
		<aside th:replace="manage/common_layout :: sidebar"></aside>

		<main id="main-container">
			<div class="container">
				<div class="row shop-header align-items-center" th:if="${store != null}">
					<div class="col-auto">
						<img th:src="${store.profile_img != null and store.profile_img != '' ? '/images/profile/' + store.profile_img : '/images/profile/default.jpg'}"
							class="shop-profile-img" onerror="this.src='/images/profile/default.jpg';">
					</div>
					<div class="col">
						<h4 class="fw-bold mb-1" th:text="${store.store_name}">상점명</h4>
						<p class="shop-info-text mb-2" th:text="${store.introduce ?: '소개글이 없습니다.'}">소개글</p>
						<div class="shop-badges">
							<span class="me-3"><i class="bi bi-shield-check"></i>본인인증 완료</span> 
							<span><i class="bi bi-shop"></i>상점오픈일 <span th:text="${store.open_days ?: 0}">0</span>일 전</span>
						</div>
					</div>
				</div>

				<div class="d-flex justify-content-between align-items-center mt-4 mb-0 border-bottom-black pb-2">
					<ul class="nav nav-tabs border-0" id="shopTabs" role="tablist">
						<li class="nav-item">
							<a class="nav-link" th:classappend="${type == 'purchase' ? 'active' : ''}"
							   th:href="@{/manage/member/member_product(userId=${userId}, type='purchase')}">구매한 상품</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:classappend="${type == 'sale' ? 'active' : ''}"
							   th:href="@{/manage/member/member_product(userId=${userId}, type='sale')}">판매한 상품</a>
						</li>
					</ul>
					
					<div class="btn-group-wrap">
						<a th:href="@{/manage/member/member_detail(userId=${userId})}" class="btn btn-sm btn-primary px-3 me-2 fw-bold">회원 상세정보</a>
						<a th:href="@{/manage/member/member_prdv(userId=${userId})}" class="btn btn-sm btn-primary px-3 fw-bold">상점 상세정보</a>
					</div>
				</div>

				<div class="tab-content mt-4">
					<div th:if="${not #lists.isEmpty(historyList)}">
						<div class="history-summary">
							<div class="prod-count">
								전체 <span>[[${historyList.size()}]]</span>개
							</div>
						</div>

						<table class="history-table">
							<thead>
								<tr>
									<th>상품번호</th>
									<th>상품 이름</th>
									<th>거래체결일자</th>
									<th th:text="${type == 'purchase' ? '판매자 상점명' : '구매자 ID'}">상대방 ID</th>
									<th>[[${type == 'purchase' ? '구매 가격' : '판매 가격'}]]</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="h : ${historyList}">
									<td th:text="${h.product_num}">번호</td>
									<td><span class="text-dark fw-medium" th:text="${h.title}">상품이름</span></td>
									<td><span class="box-date" th:text="${h.trade_date}">날짜</span></td>
									<td><span class="box-id" th:text="${h.target_id}">상대방ID</span></td>
									<td class="text-price" th:text="${h.price != null ? #numbers.formatInteger(h.price, 3, 'COMMA') + '원' : '0원'}">가격</td>
								</tr>
							</tbody>
						</table>
						
						<div class="d-flex justify-content-center mt-5">
							<div th:if="${pagination != null}" th:utext="${pagination}"></div>
						</div>
					</div>

					<div class="no-history text-center py-5" th:if="${#lists.isEmpty(historyList)}">
						<i class="bi bi-exclamation-circle fs-1 d-block mb-3 text-muted"></i>
						<p class="text-muted fw-bold" th:text="${type == 'purchase' ? '구매 기록이 존재하지 않습니다.' : '판매 기록이 존재하지 않습니다.'}"></p>
					</div>
				</div>
			</div>
		</main>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>